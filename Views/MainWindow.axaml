<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:OpenccNetLibGui.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:avaloniaEdit="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
        xmlns:helpers="clr-namespace:OpenccNetLibGui.Helpers"
        xmlns:controls="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="OpenccNetLibGui.Views.MainWindow"
        x:Name="MainWindowRoot"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/openccnetlib.ico"
        Title="OpenccNetLibGui"
        Height="700" Width="1000"
        WindowStartupLocation="CenterScreen"
        MinWidth="1000"
        MinHeight="300">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="80" />
            <RowDefinition />
            <RowDefinition Height="70" />
            <RowDefinition Height="30" />
        </Grid.RowDefinitions>
        <Grid Grid.Row="0" Grid.Column="0" Height="70" VerticalAlignment="Bottom" Margin="0,0,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition />
            </Grid.RowDefinitions>
            <RadioButton x:Name="RbT2S" Content="{Binding RbT2SContent}" Grid.Row="0" Grid.Column="0" FontSize="14"
                         Padding="5,0,0,0" Margin="20,0,0,0" VerticalAlignment="Center" HorizontalAlignment="Center"
                         IsChecked="{Binding IsRbT2S}" GroupName="MainRb" />
            <RadioButton x:Name="RbS2T" Content="{Binding RbS2TContent}" Grid.Row="0" Grid.Column="1" FontSize="14"
                         Padding="5,0,0,0" VerticalAlignment="Center" HorizontalAlignment="Center"
                         GroupName="MainRb" IsChecked="{Binding IsRbS2T}" />
            <RadioButton x:Name="RbCustom" Content="{Binding RbCustomContent}" Grid.Row="0" Grid.Column="2"
                         FontSize="14"
                         Padding="5,0,0,0" VerticalAlignment="Center" HorizontalAlignment="Left" GroupName="MainRb"
                         IsChecked="{Binding IsRbCustom}" />
            <ComboBox Name="CbCustom" Grid.Column="2" Grid.Row="0" Margin="140,0,0,0" CornerRadius="6"
                      ItemsSource="{Binding CustomOptions}"
                      SelectedItem="{Binding SelectedItem, Mode=TwoWay}">
                <Interaction.Behaviors>
                    <EventTriggerBehavior EventName="GotFocus">
                        <InvokeCommandAction Command="{Binding CmbCustomGotFocusCommand}" />
                    </EventTriggerBehavior>
                </Interaction.Behaviors>
            </ComboBox>
            <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition />
                    <ColumnDefinition />
                    <ColumnDefinition />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>

                <RadioButton x:Name="RbStd" Grid.Row="0" Grid.Column="0" Content="{Binding RbStdContent}" FontSize="14"
                             Padding="5,0,0,0" Margin="20,0,0,0" VerticalAlignment="Center" HorizontalAlignment="Left"
                             GroupName="SecondRb" IsChecked="{Binding IsRbStd}" />
                <RadioButton x:Name="RbZhtw" Grid.Row="0" Grid.Column="1" Content="{Binding RbZhtwContent}"
                             FontSize="14"
                             Padding="5,0,0,0" Margin="15,0,0,0" VerticalAlignment="Center"
                             HorizontalAlignment="Center"
                             GroupName="SecondRb" IsChecked="{Binding IsRbZhtw}" />
                <RadioButton x:Name="RbHk" Grid.Row="0" Grid.Column="2" Content="{Binding RbHkContent}" FontSize="14"
                             Padding="5,0,0,0" Margin="20,0,0,0" VerticalAlignment="Center"
                             HorizontalAlignment="Center" IsChecked="{Binding IsRbHk}"
                             GroupName="SecondRb" />
                <CheckBox x:Name="CbZhtw" Grid.Row="0" Grid.Column="3" Content="{Binding CbZhtwContent}" FontSize="13"
                          Padding="5,0,0,0" Margin="0,0,0,0" VerticalAlignment="Center" HorizontalAlignment="Left"
                          IsChecked="{Binding IsCbZhtw}" IsEnabled="{Binding IsCbZhtwEnabled}"
                          ToolTip.Tip="Using zh-CN and zh-TW idioms in conversion." />
                <CheckBox x:Name="CbPunctuation" Grid.Row="0" Grid.Column="4" Content="{Binding CbPunctuationContent}"
                          FontSize="13" Padding="5,0,0,0" Margin="5,0,0,0" VerticalAlignment="Center"
                          HorizontalAlignment="Left" IsChecked="{Binding IsCbPunctuation}"
                          ToolTip.Tip="Convert CJK punctuations between Simplified/Tradition Chinese." />
            </Grid>
        </Grid>
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="50" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>

            <TabControl Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Grid.RowSpan="2" Margin="10,0,10,0">
                <TabItem x:Name="TabMain" Header="Main Conversion" IsSelected="{Binding IsTabMain}"
                         FontSize="14" FontWeight="{Binding TabMainFontWeight}">
                    <!-- <Grid Background="#FFE5E5E5"> -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition Height="40" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <!-- <Border Grid.Row="0" Grid.Column="0" -->
                        <!--         Margin="5" -->
                        <!--         BorderThickness="3" -->
                        <!--         CornerRadius="6" -->
                        <!--         BorderBrush="DarkGray"> -->
                        <!-- å·¦é‚Š Source -->
                        <Border Grid.Row="0" Grid.Column="0"
                                Margin="8,8,4,4"
                                Classes="editor-container">
                            <avaloniaEdit:TextEditor
                                x:Name="TbSource"
                                BorderThickness="0"
                                Background="{DynamicResource ThemeBackgroundBrush}"
                                Foreground="{DynamicResource ThemeForegroundBrush}"
                                Document="{Binding TbSourceTextDocument, Mode=TwoWay}"
                                FontFamily="Noto Sans SC"
                                FontSize="16"
                                ShowLineNumbers="True"
                                WordWrap="True"
                                VerticalScrollBarVisibility="Visible"
                                TextChanged="TbSource_TextChanged">
                                <Interaction.Behaviors>
                                    <helpers:TextEditorSelectionBehavior
                                        SelectionStart="{Binding TbSourceSelectionStart, Mode=TwoWay}"
                                        SelectionLength="{Binding TbSourceSelectionLength, Mode=TwoWay}" />
                                </Interaction.Behaviors>
                                <avaloniaEdit:TextEditor.ContextMenu>
                                    <ContextMenu>
                                        <ContextMenu.Styles>
                                            <!-- æ‰€æœ‰ class="section-header" å˜… MenuItem ç”¨å‘¢å€‹æ¨£å¼ -->
                                            <Style Selector="MenuItem.section-header">
                                                <Setter Property="IsEnabled" Value="False" />
                                                <Setter Property="FontWeight" Value="Bold" />
                                                <Setter Property="Foreground" Value="Gray" />
                                                <Setter Property="Padding" Value="8,4" />
                                                <Setter Property="Background" Value="#F7F7F7" />
                                            </Style>
                                        </ContextMenu.Styles>
                                        <!-- ðŸ”¹ Section: PDF Options -->
                                        <MenuItem IsEnabled="False" Classes="section-header">
                                            <MenuItem.Header>
                                                <TextBlock Text="PDF Options"
                                                           Foreground="Gray"
                                                           FontWeight="Bold"
                                                           LetterSpacing="0.5"
                                                           Padding="8,4" />
                                            </MenuItem.Header>
                                        </MenuItem>

                                        <!-- ðŸ“ Convert filename -->
                                        <!-- IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsCbConvertFilename, Mode=TwoWay}"> -->
                                        <MenuItem ToggleType="CheckBox"
                                                  IsChecked="{Binding DataContext.IsCbConvertFilename, ElementName=MainWindowRoot, Mode=TwoWay, FallbackValue=false}">
                                            <MenuItem.Header>
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <TextBlock Text="ðŸ“" />
                                                    <TextBlock Text="Convert filename" />
                                                </StackPanel>
                                            </MenuItem.Header>
                                        </MenuItem>

                                        <!-- ðŸ“„ Add page header -->
                                        <MenuItem ToggleType="CheckBox"
                                                  IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsAddPdfPageHeader, Mode=TwoWay, FallbackValue=false}">
                                            <MenuItem.Header>
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <TextBlock Text="ðŸ“„" />
                                                    <TextBlock Text="Add page header" />
                                                </StackPanel>
                                            </MenuItem.Header>
                                        </MenuItem>

                                        <!-- ðŸ”§ Compact PDF text -->
                                        <MenuItem ToggleType="CheckBox"
                                                  IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsCompactPdfText, Mode=TwoWay, FallbackValue=false}">
                                            <MenuItem.Header>
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <TextBlock Text="ðŸ”§" />
                                                    <TextBlock Text="Compact PDF text" />
                                                </StackPanel>
                                            </MenuItem.Header>
                                        </MenuItem>

                                        <!-- ðŸ”ƒ Auto-Reflow PDF text -->
                                        <MenuItem ToggleType="CheckBox"
                                                  IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsAutoReflow, Mode=TwoWay, FallbackValue=true}">
                                            <MenuItem.Header>
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <TextBlock Text="ðŸ”ƒ" />
                                                    <TextBlock Text="Auto-Reflow PDF text" />
                                                </StackPanel>
                                            </MenuItem.Header>
                                        </MenuItem>

                                        <!-- Separator -->
                                        <Separator />

                                        <!-- ðŸ”¹ Section: PDF Engine -->
                                        <MenuItem IsEnabled="False" Classes="section-header">
                                            <MenuItem.Header>
                                                <TextBlock Text="PDF Engine"
                                                           Foreground="Gray"
                                                           FontWeight="Bold"
                                                           LetterSpacing="0.5"
                                                           Padding="8,4" />
                                            </MenuItem.Header>
                                        </MenuItem>

                                        <!-- âš™ï¸ Use PdfPig engine -->
                                        <MenuItem ToggleType="Radio"
                                                  IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsPdfPigEngine, Mode=TwoWay, FallbackValue=false}"
                                                  ToolTip.Tip="Managed PdfPig engine â€“ fast and great for simple text-based PDFs.">
                                            <MenuItem.Header>
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <TextBlock Text="âš™ï¸" />
                                                    <TextBlock Text="Use PdfPig engine" />
                                                </StackPanel>
                                            </MenuItem.Header>
                                        </MenuItem>

                                        <!-- âš™ï¸ Use Pdfium engine -->
                                        <MenuItem ToggleType="Radio"
                                                  IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsPdfiumEngine, Mode=TwoWay, FallbackValue=true}"
                                                  ToolTip.Tip="Native Pdfium engine â€“ better for complex layout, rotated text, and tricky PDFs.">
                                            <MenuItem.Header>
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <TextBlock Text="âš™ï¸" />
                                                    <TextBlock Text="Use Pdfium (native) engine" />
                                                </StackPanel>
                                            </MenuItem.Header>
                                        </MenuItem>

                                        <!-- Separator -->
                                        <Separator />

                                        <!-- ðŸ”¹ Section: Heading rules -->
                                        <MenuItem IsEnabled="False" Classes="section-header">
                                            <MenuItem.Header>
                                                <TextBlock Text="Heading rules"
                                                           Foreground="Gray"
                                                           FontWeight="Bold"
                                                           LetterSpacing="0.5"
                                                           Padding="8,4" />
                                            </MenuItem.Header>
                                        </MenuItem>

                                        <!-- âœï¸ Short heading settings -->
                                        <MenuItem Command="{Binding ShowShortHeadingDialogCommand}"
                                                  ToolTip.Tip="Configure short heading detection rules, including maximum length and allowed character patterns.">
                                            <MenuItem.Header>
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <TextBlock Text="âœï¸" />
                                                    <TextBlock Text="Short heading settings..." />
                                                </StackPanel>
                                            </MenuItem.Header>
                                        </MenuItem>

                                        <Separator />

                                        <!-- ðŸ’¾ Save advanced settings -->
                                        <MenuItem Command="{Binding SaveLanguageSettingsCommand}"
                                                  IsEnabled="{Binding IsSettingsDirty}"
                                                  ToolTip.Tip="Writes UserLanguageSettings.json (advanced users only)">
                                            <MenuItem.Header>
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <controls:SymbolIcon Symbol="Save" FontSize="20" />
                                                    <TextBlock Text="Save advanced settingsâ€¦" />
                                                </StackPanel>
                                            </MenuItem.Header>
                                        </MenuItem>

                                    </ContextMenu>
                                </avaloniaEdit:TextEditor.ContextMenu>
                            </avaloniaEdit:TextEditor>
                        </Border>

                        <!-- <Border Grid.Row="0" Grid.Column="1" -->
                        <!--         Margin="5" -->
                        <!--         BorderThickness="3" -->
                        <!--         CornerRadius="6" -->
                        <!--         BorderBrush="DarkGray"> -->
                        <!-- å³é‚Š Destination -->
                        <Border Grid.Row="0" Grid.Column="1"
                                Margin="4,8,8,4"
                                Classes="editor-container">
                            <avaloniaEdit:TextEditor
                                x:Name="TbDestination"
                                BorderThickness="0"
                                Background="{DynamicResource ThemeBackgroundBrush}"
                                Foreground="{DynamicResource ThemeForegroundBrush}"
                                Document="{Binding TbDestinationTextDocument}"
                                FontFamily="Noto Sans SC"
                                FontSize="16"
                                ShowLineNumbers="True"
                                WordWrap="True"
                                VerticalScrollBarVisibility="Visible"
                                IsReadOnly="True" />
                        </Border>

                        <Label Grid.Row="1" Grid.Column="0" Content="Source:" HorizontalAlignment="Left"
                               VerticalAlignment="Center" Margin="5,0,0,0" FontSize="16" BorderBrush="DarkGray"
                               BorderThickness="3,0,0,2" />
                        <Label x:Name="LblSourceCode" Grid.Row="1" Grid.Column="0"
                               Content="{Binding LblSourceCodeContent}"
                               HorizontalAlignment="Left" VerticalAlignment="Center" Margin="70,0,0,0" FontSize="16" />
                        <Label x:Name="LblTotalChars" Grid.Row="1" Grid.Column="0"
                               Content="{Binding LblTotalCharsContent}" HorizontalAlignment="Right"
                               VerticalAlignment="Center" Margin="0,0,175,0" FontSize="14" />
                        <Button x:Name="BthReflow" Grid.Row="1" Grid.Column="0" Padding="0 2" Width="40"
                                HorizontalAlignment="Right" VerticalAlignment="Center"
                                HorizontalContentAlignment="Center"
                                Margin="0,2,135,0" FontSize="14" FontWeight="Bold"
                                ToolTip.Tip="Reflow CJK paragraphs extracted from PDF text."
                                Command="{Binding BtnReflowCommand}">
                            <StackPanel Orientation="Horizontal">
                                <controls:SymbolIcon Symbol="Refresh" FontSize="20" />
                            </StackPanel>
                        </Button>
                        <Label Grid.Column="1" Content="Destination:" HorizontalAlignment="Left" Margin="5,0,0,0"
                               Grid.Row="1" VerticalAlignment="Center" FontSize="16" BorderBrush="DarkGray"
                               BorderThickness="3,0,0,2" />
                        <Label x:Name="LblDestinationCode" Grid.Column="1"
                               Content="{Binding LblDestinationCodeContent}" HorizontalAlignment="Left"
                               Margin="110,0,0,0" Grid.Row="1" VerticalAlignment="Center" FontSize="16" />
                        <Button x:Name="BtnClearSource" Padding="0 2" Width="40"
                                HorizontalAlignment="Right" HorizontalContentAlignment="Center"
                                Margin="0,2,90,0" Grid.Row="1" ToolTip.Tip="Clear source text box."
                                Grid.Column="0" VerticalAlignment="Center" FontSize="14"
                                Command="{Binding BtnClearTbSourceCommand}"
                                FontWeight="Bold">
                            <controls:SymbolIcon Symbol="Delete" FontSize="20" />
                        </Button>
                        <Button x:Name="BtnPaste" Padding="5 2" Width="80" HorizontalAlignment="Right"
                                HorizontalContentAlignment="Center" FontWeight="SemiBold"
                                Margin="0,2,5,0" Grid.Row="1" Height="26"
                                Grid.Column="0" VerticalAlignment="Center" FontSize="14"
                                Command="{Binding BtnPasteCommand}">
                            <StackPanel Orientation="Horizontal" Spacing="3">
                                <controls:SymbolIcon Symbol="Paste" FontSize="20" />
                                <TextBlock Text="Paste" />
                            </StackPanel>
                        </Button>
                        <Button x:Name="BtnClearDestination" Grid.Column="1" Padding="0 2" Width="40"
                                HorizontalAlignment="Right" HorizontalContentAlignment="Center" Margin="0,2,90,0"
                                Grid.Row="1" VerticalAlignment="Center" ToolTip.Tip="Clear destination text box."
                                FontSize="14" Command="{Binding BtnClearTbDestinationCommand}" FontWeight="Bold">
                            <controls:SymbolIcon Symbol="Delete" FontSize="20" />
                        </Button>
                        <Button x:Name="BtnCopy" Grid.Column="1" Padding="5 2" Width="80"
                                HorizontalAlignment="Right" HorizontalContentAlignment="Center" Margin="0,2,5,0"
                                Grid.Row="1" VerticalAlignment="Center" FontWeight="SemiBold"
                                FontSize="14" Command="{Binding BtnCopyCommand}">
                            <StackPanel Orientation="Horizontal" Spacing="3">
                                <controls:SymbolIcon Symbol="Copy" FontSize="20" />
                                <TextBlock Text="Copy" />
                            </StackPanel>
                        </Button>
                    </Grid>
                </TabItem>
                <TabItem x:Name="TabBatch" Header="Batch Conversion" IsSelected="{Binding IsTabBatch}" FontSize="14"
                         FontWeight="{Binding TabBatchFontWeight}">
                    <!-- <Grid Background="#FFE5E5E5"> -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition Height="40" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <ListBox x:Name="LbxSource" Grid.Row="0" Grid.Column="0" Margin="5,5,5,0"
                                 BorderThickness="2,2,2,2" ItemsSource="{Binding LbxSourceItems}"
                                 SelectedIndex="{Binding LbxSourceSelectedIndex, Mode=TwoWay}"
                                 SelectedItem="{Binding LbxSourceSelectedItem, Mode=TwoWay}"
                                 ScrollViewer.HorizontalScrollBarVisibility="Auto">
                            <ListBox.ContextMenu>
                                <ContextMenu>
                                    <ContextMenu.Styles>
                                        <!-- æ‰€æœ‰ class="section-header" å˜… MenuItem ç”¨å‘¢å€‹æ¨£å¼ -->
                                        <Style Selector="MenuItem.section-header">
                                            <Setter Property="IsEnabled" Value="False" />
                                            <Setter Property="FontWeight" Value="Bold" />
                                            <Setter Property="Foreground" Value="Gray" />
                                            <Setter Property="Padding" Value="8,4" />
                                            <Setter Property="Background" Value="#F7F7F7" />
                                        </Style>
                                    </ContextMenu.Styles>
                                    <!-- ðŸ”¹ Section: PDF Options -->
                                    <MenuItem IsEnabled="False" Classes="section-header">
                                        <MenuItem.Header>
                                            <TextBlock Text="PDF Options"
                                                       Foreground="Gray"
                                                       FontWeight="Bold"
                                                       LetterSpacing="0.5"
                                                       Padding="8,4" />
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <!-- ðŸ“ Convert filename -->
                                    <MenuItem ToggleType="CheckBox"
                                              IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsCbConvertFilename, Mode=TwoWay, FallbackValue=false}">
                                        <MenuItem.Header>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <TextBlock Text="ðŸ“" />
                                                <TextBlock Text="Convert filename" />
                                            </StackPanel>
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <!-- ðŸ“„ Add page header -->
                                    <MenuItem ToggleType="CheckBox"
                                              IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsAddPdfPageHeader, Mode=TwoWay, FallbackValue=false}">
                                        <MenuItem.Header>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <TextBlock Text="ðŸ“„" />
                                                <TextBlock Text="Add page header" />
                                            </StackPanel>
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <!-- ðŸ”§ Compact PDF text -->
                                    <MenuItem ToggleType="CheckBox"
                                              IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsCompactPdfText, Mode=TwoWay, FallbackValue=false}">
                                        <MenuItem.Header>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <TextBlock Text="ðŸ”§" />
                                                <TextBlock Text="Compact PDF text" />
                                            </StackPanel>
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <!-- ðŸ”ƒ Auto-Reflow PDF text -->
                                    <MenuItem ToggleType="CheckBox"
                                              IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsAutoReflow, Mode=TwoWay, FallbackValue=true}">
                                        <MenuItem.Header>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <TextBlock Text="ðŸ”ƒ" />
                                                <TextBlock Text="Auto-Reflow PDF text" />
                                            </StackPanel>
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <!-- Separator -->
                                    <Separator />

                                    <!-- ðŸ”¹ Section: PDF Engine -->
                                    <MenuItem IsEnabled="False" Classes="section-header">
                                        <MenuItem.Header>
                                            <TextBlock Text="PDF Engine"
                                                       Foreground="Gray"
                                                       FontWeight="Bold"
                                                       LetterSpacing="0.5"
                                                       Padding="8,4" />
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <!-- âš™ï¸ Use PdfPig engine -->
                                    <MenuItem ToggleType="Radio"
                                              IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsPdfPigEngine, Mode=TwoWay, FallbackValue=false}"
                                              ToolTip.Tip="Managed PdfPig engine â€“ fast and great for simple text-based PDFs.">
                                        <MenuItem.Header>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <TextBlock Text="âš™ï¸" />
                                                <TextBlock Text="Use PdfPig engine" />
                                            </StackPanel>
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <!-- âš™ï¸ Use Pdfium engine -->
                                    <MenuItem ToggleType="Radio"
                                              IsChecked="{Binding #MainWindowRoot.((vm:MainWindowViewModel)DataContext).IsPdfiumEngine, Mode=TwoWay, FallbackValue=true}"
                                              ToolTip.Tip="Native Pdfium engine â€“ better for complex layout, rotated text, and tricky PDFs.">
                                        <MenuItem.Header>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <TextBlock Text="âš™ï¸" />
                                                <TextBlock Text="Use Pdfium (native) engine" />
                                            </StackPanel>
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <!-- Separator -->
                                    <Separator />

                                    <!-- ðŸ”¹ Section: Heading rules -->
                                    <MenuItem IsEnabled="False" Classes="section-header">
                                        <MenuItem.Header>
                                            <TextBlock Text="Heading rules"
                                                       Foreground="Gray"
                                                       FontWeight="Bold"
                                                       LetterSpacing="0.5"
                                                       Padding="8,4" />
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <!-- âœï¸ Short heading settings -->
                                    <MenuItem Command="{Binding ShowShortHeadingDialogCommand}"
                                              ToolTip.Tip="Configure short heading detection rules, including maximum length and allowed character patterns.">
                                        <MenuItem.Header>
                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                <TextBlock Text="âœï¸" />
                                                <TextBlock Text="Short heading settings..." />
                                            </StackPanel>
                                        </MenuItem.Header>
                                    </MenuItem>

                                    <Separator />

                                    <!-- ðŸ’¾ Save advanced settings -->
                                    <MenuItem Command="{Binding SaveLanguageSettingsCommand}"
                                              IsEnabled="{Binding IsSettingsDirty}"
                                              ToolTip.Tip="Writes UserLanguageSettings.json (advanced users only)">
                                        <MenuItem.Header>
                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                <controls:SymbolIcon Symbol="Save" FontSize="20" />
                                                <TextBlock Text="Save advanced settingsâ€¦" />
                                            </StackPanel>
                                        </MenuItem.Header>
                                    </MenuItem>

                                </ContextMenu>
                            </ListBox.ContextMenu>
                        </ListBox>
                        <Label Grid.Row="1" Grid.Column="0" Content="Source:" HorizontalAlignment="Left"
                               VerticalAlignment="Center" Margin="5,0,0,0" FontSize="16" BorderBrush="DarkGray"
                               BorderThickness="3,0,0,2" />

                        <TabControl Grid.Row="0" Grid.Column="1" TabStripPlacement="Bottom">
                            <TabItem x:Name="TabMessage" Header="Message" FontSize="14"
                                     IsSelected="{Binding IsTabMessage}"
                                     FontWeight="Medium">
                                <Grid>
                                    <ListBox x:Name="LbxDestination" Grid.Row="0" Grid.Column="0" Margin="0,5,0,0"
                                             BorderThickness="2,2,2,2" ItemsSource="{Binding LbxDestinationItems}"
                                             ScrollViewer.HorizontalScrollBarVisibility="Auto">
                                        <!-- LOG ListBox auto-scroll view to last item -->
                                        <Interaction.Behaviors>
                                            <helpers:AutoScrollBehavior />
                                        </Interaction.Behaviors>
                                    </ListBox>
                                </Grid>
                            </TabItem>
                            <TabItem x:Name="TabPreview" Header="Preview" FontSize="14" FontWeight="Medium"
                                     IsSelected="{Binding IsTabPreview}">
                                <Grid>
                                    <!-- <TextBox x:Name="TbPreview" Grid.Row="0" Grid.Column="0" Margin="0,5,0,0" -->
                                    <!--          BorderThickness="2,2,2,2" FontSize="16" IsReadOnly="True" -->
                                    <!--          FontFamily="Noto Sans SC" -->
                                    <!--          TextWrapping="Wrap" Text="{Binding TbPreviewText}" /> -->
                                    <avaloniaEdit:TextEditor x:Name="TbPreview"
                                                             Grid.Row="0" Grid.Column="0"
                                                             Margin="0,5,0,0"
                                                             BorderThickness="3"
                                                             BorderBrush="DarkGray"
                                                             Document="{Binding TbPreviewTextDocument}"
                                                             WordWrap="True"
                                                             VerticalScrollBarVisibility="Visible"
                                                             ShowLineNumbers="False" FontFamily="Noto Sans SC"
                                                             FontSize="16" IsReadOnly="True" />
                                </Grid>
                            </TabItem>
                        </TabControl>

                        <Label Grid.Column="1" Content="Output:" HorizontalAlignment="Left" Margin="5,0,0,0"
                               Grid.Row="1" VerticalAlignment="Center" FontSize="16" BorderBrush="DarkGray"
                               BorderThickness="3,0,0,2" />
                        <Button x:Name="BtnAdd" Padding="0 2" Width="50" HorizontalAlignment="Left"
                                HorizontalContentAlignment="Center" ToolTip.Tip="Add file to Source List Box."
                                Margin="70,2,0,2" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" FontSize="14"
                                FontWeight="Bold" Command="{Binding BtnAddCommand}">
                            <!-- <StackPanel Orientation="Horizontal"> -->
                            <!--     <controls:SymbolIcon Symbol="Add" FontSize="20" /> -->
                            <!-- </StackPanel> -->
                            <ContentControl Content="{DynamicResource Icon.Add}" />
                        </Button>
                        <Button x:Name="BtnRemove" Padding="0 2" Width="50" HorizontalAlignment="Left"
                                HorizontalContentAlignment="Center" Margin="125,2,0,2"
                                Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"
                                FontSize="14" ToolTip.Tip="Remove selected item in Source List Box."
                                FontWeight="Bold" Command="{Binding BtnRemoveCommand}">
                            <ContentControl Content="{DynamicResource Icon.Remove}" />
                        </Button>
                        <CheckBox x:Name="CbConvertFilename" Grid.Row="1" Grid.Column="0" Content="Filename"
                                  FontSize="13" FontWeight="SemiBold" Padding="5,0" Margin="180,2,0,2"
                                  VerticalAlignment="Center"
                                  ToolTip.Tip="Convert output filename using current configuration."
                                  HorizontalAlignment="Left" IsChecked="{Binding IsCbConvertFilename}" />
                        <Button x:Name="BtnPreview" Content="Preview" Padding="0 2" Width="70"
                                HorizontalAlignment="Right" HorizontalContentAlignment="Center" Margin="0,2,135,2"
                                Grid.Row="1" Grid.Column="0" FontWeight="SemiBold" Height="26"
                                ToolTip.Tip="Preview selected file in Preview Box."
                                VerticalAlignment="Center" FontSize="14" Command="{Binding BtnPreviewCommand}" />
                        <Button x:Name="BtnDetect" Content="Detect" Padding="0 2" Width="70"
                                HorizontalAlignment="Right" HorizontalContentAlignment="Center" Margin="0,2,60,2"
                                Grid.Row="1" Grid.Column="0" FontWeight="SemiBold" Height="26"
                                ToolTip.Tip="Detect Chinese variants (zho code) for files in List Box."
                                VerticalAlignment="Center" FontSize="14" Command="{Binding BtnDetectCommand}" />
                        <Button x:Name="BtnClear" Padding="0 2" Width="50" HorizontalAlignment="Right"
                                HorizontalContentAlignment="Center" ToolTip.Tip="Clear all items in Source List Box."
                                Margin="0,2,5,2" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" FontSize="14"
                                FontWeight="Bold" Command="{Binding BtnClearLbxSourceCommand}">
                            <StackPanel Orientation="Horizontal">
                                <controls:SymbolIcon Symbol="Delete" FontSize="20" />
                            </StackPanel>
                        </Button>
                        <TextBox x:Name="TbOutFolder" Grid.Row="1" Grid.Column="1" Width="290"
                                 Text="{Binding TbOutFolderText}"
                                 HorizontalAlignment="Left" VerticalAlignment="Center"
                                 helpers:FocusAttachedProperty.IsFocused="{Binding IsTbOutFolderFocus}"
                                 VerticalContentAlignment="Center" Margin="75,2,2,2" Padding="0 2" />
                        <Button x:Name="BtnOutFolder" Padding="0 2" Width="50" HorizontalAlignment="Right"
                                HorizontalContentAlignment="Center" ToolTip.Tip="Select output folder."
                                Margin="0,2,60,2" Grid.Row="1" Grid.Column="1" VerticalAlignment="Center" FontSize="14"
                                FontWeight="Bold" Command="{Binding BtnSelectOutFolderCommand}">
                            <StackPanel Orientation="Horizontal">
                                <controls:SymbolIcon Symbol="OpenFolder" FontSize="20" />
                            </StackPanel>
                        </Button>
                        <Button x:Name="BtnOutClear" Padding="0 2" Width="50" HorizontalAlignment="Right"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Height="26"
                                Margin="0,2,5,2" Grid.Row="1" Grid.Column="1" VerticalAlignment="Center" FontSize="14"
                                ToolTip.Tip="Clear current display box."
                                FontWeight="Bold" Command="{Binding BtnMessagePreviewClearCommand}">
                            <StackPanel Orientation="Horizontal">
                                <controls:SymbolIcon Symbol="Delete" FontSize="20" />
                            </StackPanel>
                        </Button>

                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>
        <!-- <Button x:Name="BtnProcess" Content="Process" Padding="0 2" Width="100" HorizontalAlignment="Center" -->
        <!--         HorizontalContentAlignment="Center" IsVisible="{Binding IsBtnProcessVisible}" -->
        <!--         Margin="0,0,0,0" Grid.Row="2" VerticalAlignment="Center" FontSize="18" FontWeight="Bold" -->
        <!--         Command="{Binding BtnProcessCommand}" Foreground="RoyalBlue" /> -->
        <Button x:Name="BtnProcess"
                Padding="6,6,12, 6"
                Grid.Row="2"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                IsVisible="{Binding IsBtnProcessVisible}"
                Command="{Binding BtnProcessCommand}"
                Classes="accent-button">
            <StackPanel Orientation="Horizontal" Spacing="6">
                <controls:SymbolIcon Symbol="Play" FontSize="22" />
                <TextBlock Text="Process" />
            </StackPanel>
        </Button>

        <!-- <Button x:Name="BtnBatchStart" Content="Batch Start" Padding="0 2" Width="120" HorizontalAlignment="Center" -->
        <!--         HorizontalContentAlignment="Center" Foreground="RoyalBlue" -->
        <!--         Margin="0,0,0,0" Grid.Row="2" VerticalAlignment="Center" FontSize="18" FontWeight="Bold" -->
        <!--         IsVisible="{Binding IsBtnBatchStartVisible}" Command="{Binding BtnBatchStartCommand}" /> -->
        <Button x:Name="BtnBatchStart"
                Padding="6,6,12, 6"
                Grid.Row="2"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                IsVisible="{Binding IsBtnBatchStartVisible}"
                Command="{Binding BtnBatchStartCommand}"
                Classes="accent-button">
            <StackPanel Orientation="Horizontal" Spacing="6">
                <controls:SymbolIcon Symbol="Play" FontSize="22" />
                <TextBlock Text="Batch Start" />
            </StackPanel>
        </Button>

        <Button x:Name="BtnOpenFile" Padding="5 2" HorizontalAlignment="Left"
                HorizontalContentAlignment="Center" IsVisible="{Binding IsBtnOpenFileVisible}"
                Margin="20,0,0,0" Grid.Row="2" VerticalAlignment="Center" FontSize="14"
                ToolTip.Tip="Open file for source text box contents."
                Command="{Binding BtnOpenFileCommand}" Classes="outline-button">
            <StackPanel Orientation="Horizontal" Spacing="0">
                <controls:SymbolIcon Symbol="OpenFile" FontSize="20" />
                <TextBlock Text="Open File" />
            </StackPanel>
        </Button>
        <Label x:Name="LblFileName" Content="{Binding LblFileNameContent}" Padding="0 2" HorizontalAlignment="Left"
               Margin="120,0,0,0" Grid.Row="2" IsVisible="{Binding IsLblFileNameVisible}"
               VerticalAlignment="Center" FontSize="14" />
        <ComboBox x:Name="CmbSaveTarget" Width="120" Margin="0,0,175,0" Grid.Row="2"
                  VerticalAlignment="Center" HorizontalAlignment="Right" CornerRadius="6"
                  ToolTip.Tip="Select target textbox contents to save as text file."
                  ItemsSource="{Binding SaveTargets}" IsVisible="{Binding IsCmbSaveTargetVisible}"
                  SelectedItem="{Binding SelectedSaveTarget}">
            <ComboBox.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding}" />
                </DataTemplate>
            </ComboBox.ItemTemplate>
        </ComboBox>
        <Button x:Name="BtnSaveFile" Padding="5 2" HorizontalAlignment="Right"
                HorizontalContentAlignment="Center" IsVisible="{Binding IsBtnSaveFileVisible}"
                Margin="0,0,80,0" Grid.Row="2" VerticalAlignment="Center" FontSize="14" Classes="outline-button"
                ToolTip.Tip="Save selected target as text file."
                Command="{Binding BtnSaveFileCommand}">
            <StackPanel Orientation="Horizontal" Spacing="0">
                <controls:SymbolIcon Symbol="SaveAs" FontSize="20" />
                <TextBlock Text="Save As" />
            </StackPanel>
        </Button>
        <Button x:Name="BtnExit" Content=" Exit " Padding="5 2" Width="50" HorizontalAlignment="Right"
                HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Classes="outline-button"
                Height="30"
                Margin="0,0,20,0" Grid.Row="2" VerticalAlignment="Center" FontSize="14" Foreground="Red"
                FontWeight="SemiBold" Click="BtnExit_Click" />
        <StackPanel x:Name="StbStatusBar" Grid.Row="3" Height="30">
            <Label x:Name="LblStatusBar" Content="{Binding LblStatusBarContent}" Padding="0 2" Margin="10,0,0,0"
                   HorizontalAlignment="Left" VerticalAlignment="Top" FontSize="14" />
        </StackPanel>
    </Grid>

    <!--<TextBlock Text="{Binding Greeting}" HorizontalAlignment="Center" VerticalAlignment="Center"/>-->

</Window>